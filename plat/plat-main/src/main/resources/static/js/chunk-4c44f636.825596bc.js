(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c44f636"],{"068a":function(t,e,n){(function(t,n){n(e)})(0,(function(t){"use strict";var e=function(t,e){var n,i,a,o,s,r=function(){t.apply(o,s),i=n};return function(){if(o=this,s=arguments,n=Date.now(),a&&(clearTimeout(a),a=null),i){var t=e-(n-i);t<0?r():a=setTimeout((function(){r()}),t)}else r()}},n=function(t){return t===window?Math.max(window.pageYOffset||0,document.documentElement.scrollTop):t.scrollTop},i=document.defaultView.getComputedStyle,a=function(t){var e=t;while(e&&"HTML"!==e.tagName&&"BODY"!==e.tagName&&1===e.nodeType){var n=i(e).overflowY;if("scroll"===n||"auto"===n)return e;e=e.parentNode}return window},o=function(t){return t===window?document.documentElement.clientHeight:t.clientHeight},s=function(t){return t===window?n(window):t.getBoundingClientRect().top+n(window)},r=function(t){var e=t.parentNode;while(e){if("HTML"===e.tagName)return!0;if(11===e.nodeType)return!1;e=e.parentNode}return!1},l={doBind:function(){if(!this.binded){this.binded=!0;var t=this,n=t.el;t.scrollEventTarget=a(n),t.scrollListener=e(t.doCheck.bind(t),200),t.scrollEventTarget.addEventListener("scroll",t.scrollListener);var i=n.getAttribute("infinite-scroll-disabled"),o=!1;i&&(this.vm.$watch(i,(function(e){t.disabled=e,!e&&t.immediateCheck&&t.doCheck()})),o=Boolean(t.vm.$get(i))),t.disabled=o;var s=n.getAttribute("infinite-scroll-distance"),r=0;s&&(r=Number(t.vm.$get(s)),isNaN(r)&&(r=0)),t.distance=r;var l=n.getAttribute("infinite-scroll-immediate-check"),c=!0;l&&(c=Boolean(t.vm.$get(l))),t.immediateCheck=c,c&&t.doCheck();var d=n.getAttribute("infinite-scroll-listen-for-event");d&&t.vm.$on(d,(function(){t.doCheck()}))}},doCheck:function(t){var e=this.scrollEventTarget,i=this.el,a=this.distance;if(!0===t||!this.disabled){var r=n(e),l=r+o(e),c=!1;if(e===i)c=e.scrollHeight-l<=a;else{var d=s(i)-s(e)+i.offsetHeight+r;c=l+a>=d}c&&this.expression&&this.vm.$get(this.expression)}},bind:function(){var t=this,e=this.el;t.vm.$on("hook:ready",(function(){r(e)&&t.doBind()})),this.bindTryCount=0;var n=function n(){t.bindTryCount>10||(t.bindTryCount++,r(e)?t.doBind():setTimeout(n,50))};n()},unbind:function(){this.scrollEventTarget.removeEventListener("scroll",this.scrollListener)}};function c(t){t.directive("infiniteScroll",l)}window.Vue&&(window.infiniteScroll=l,Vue.use(c)),t.install=c,t.infiniteScroll=l}))},"50c5":function(t,e,n){},"6ebd":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-row",{attrs:{id:"fullContainer",gutter:8}},[n("a-col",{attrs:{span:6}},[n("div",[n("a-row",{attrs:{gutter:24}},[n("a-col",{style:{marginBottom:"24px"},attrs:{sm:24,md:12,xl:12}},[n("chart-card",{attrs:{loading:t.loading,hasFooter:!1,title:"今日上报数",total:t._f("NumberFormat")(t.reportData["上报"])}},[n("a-tooltip",{attrs:{slot:"action",title:"指标说明"},slot:"action"},[n("a-icon",{attrs:{type:"info-circle-o"}})],1),n("div",[n("span",{attrs:{slot:"term"},slot:"term"},[t._v("自采案件")]),n("span",{attrs:{slot:"term"},slot:"term"},[t._v(t._s(t._f("NumberFormat")(0)))])]),n("div",[n("span",{attrs:{slot:"term"},slot:"term"},[t._v("市局下派")]),n("span",{attrs:{slot:"term"},slot:"term"},[t._v(t._s(t._f("NumberFormat")(0)))])])],1)],1),n("a-col",{style:{marginBottom:"24px"},attrs:{sm:24,md:12,xl:12}},[n("chart-card",{attrs:{loading:t.loading,hasFooter:!1,title:"今日处置数",total:t._f("NumberFormat")(t.reportData["处置"])}},[n("a-tooltip",{attrs:{slot:"action",title:"指标说明"},slot:"action"},[n("a-icon",{attrs:{type:"info-circle-o"}})],1),n("div",[n("span",{attrs:{slot:"term"},slot:"term"},[t._v("自采案件")]),n("span",{attrs:{slot:"term"},slot:"term"},[t._v(t._s(t._f("NumberFormat")(0)))])]),n("div",[n("span",{attrs:{slot:"term"},slot:"term"},[t._v("市局下派")]),n("span",{attrs:{slot:"term"},slot:"term"},[t._v(t._s(t._f("NumberFormat")(0)))])])],1)],1),n("a-col",{style:{marginBottom:"24px"},attrs:{sm:24,md:24,xl:24}},[n("chart-card",{attrs:{loading:t.loading,hasTotal:!1,hasFooter:!1,title:"案件数量",divHeight:285}},[n("div",[n("stacking-bar",{style:{padding:"0px"},attrs:{data:t.barData2,xArr:t.areaArr}})],1),n("a-tooltip",{attrs:{slot:"action",title:"指标说明"},slot:"action"},[n("a-icon",{attrs:{type:"info-circle-o"}})],1)],1)],1),n("a-col",{style:{marginBottom:"24px"},attrs:{sm:24,md:24,xl:24}},[n("chart-card",{attrs:{loading:t.loading,hasFooter:!0,title:"今日结案数",total:t._f("NumberFormat")(t.reportData["结案"]),divHeight:285}},[n("a-tooltip",{attrs:{slot:"action",title:"指标说明"},slot:"action"},[n("a-icon",{attrs:{type:"info-circle-o"}})],1),n("div",[n("mini-pie")],1),n("template",{slot:"footer"},[t._v("转化率 "),n("span",[t._v("60%")])])],2)],1)],1)],1)]),n("a-col",{attrs:{span:12}},[n("a-card",{attrs:{bordered:!1}},[n("div",[n("div",{staticStyle:{width:"100%","min-height":"500px"},style:{height:t.getHeight},attrs:{id:"container"}})])])],1),n("a-col",{attrs:{span:6}},[n("a-card",{attrs:{bordered:!1}},[n("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.handleInfiniteOnLoad,expression:"handleInfiniteOnLoad"}],staticClass:"demo-infinite-container",style:{height:t.getHeight},attrs:{"infinite-scroll-disabled":t.busy,"infinite-scroll-distance":10}},[t._l(t.data,(function(e,i){return n("a-descriptions",{attrs:{layout:"vertical",size:"small"}},[n("a-descriptions-item",{attrs:{label:"案件编号"}},[n("a",{on:{click:function(n){return t.showCase(e)}}},[t._v(t._s(e.caseNo))])]),n("a-descriptions-item",{attrs:{label:"状态"}},[n("a-badge",{attrs:{color:t.caseColors[e.state],text:t.statusObj[e.status]}})],1),n("a-descriptions-item",{attrs:{label:"上报人"}},[t._v(" "+t._s(e.reportor)+" ")]),n("a-descriptions-item",{attrs:{label:"案件来源"}},[t._v(" "+t._s(e.casesource)+" ")]),n("a-descriptions-item",{attrs:{label:"案件类型"}},[t._v(" "+t._s(e.caseType)+" ")]),n("a-descriptions-item",{attrs:{label:"案件样本"}},[t._v(" "+t._s(e.sampleName)+" ")]),n("a-descriptions-item",{attrs:{label:"上报时间"}},[t._v(" "+t._s(e.reporTime)+" ")]),n("a-descriptions-item",{attrs:{label:"案件描述",span:"1"}},[n("Ellipsis",{attrs:{length:10,tooltip:""}},[t._v(t._s(e.caseDesc))])],1),n("a-descriptions-item",{attrs:{label:"操作"}},[n("button",{staticClass:"btn",on:{click:function(n){return t.info(e)}}},[t._v("处置")])])],1)})),t.data.length>=t.pagination.pageSize?n("div",{staticStyle:{"text-align":"center"}},[n("a",{on:{click:function(e){return t.loadMore()}}},[t._v("加载更多")])]):t._e()],2)])],1),n("div",{staticClass:"input-card",staticStyle:{width:"60px"},attrs:{id:"amapContainer"}},[t.isFullScreen?n("a-icon",{style:{fontSize:"30px"},attrs:{type:"fullscreen-exit"},on:{click:function(e){return t.exitFullScreen()}}}):n("a-icon",{style:{fontSize:"30px"},attrs:{type:"fullscreen"},on:{click:function(e){return t.fullScreen()}}})],1),n("Edit",{attrs:{modalData:t.modalData},on:{handleModalEvent:t.handleModalEvent}})],1)},a=[],o=(n("b4fb"),n("fe59"),n("2eeb"),n("08ba"),n("6c6d")),s=n("2af9"),r=(n("ac0d"),n("d4f4")),l=(n("850b"),n("2395")),c=n("1cfa"),d=n.n(c),u=n("5880"),p=n("e819"),h=n("9452"),f=n("068a"),m=n.n(f),g=n("5141"),b=n("fee9"),v=n.n(b),w=n("4367"),y=n.n(w),k=n("9081"),x=n("6cf5"),S=n("3fc3"),C=n("4f57"),_=n("049a"),M={child:C["a"].any,bordered:C["a"].bool,colon:C["a"].bool,type:C["a"].oneOf(["label","content"]),layout:C["a"].oneOf(["horizontal","vertical"])},O={functional:!0,props:M,render:function(t,e){var n,i=e.props,a=i.child,o=i.bordered,s=i.colon,r=i.type,l=i.layout,c=Object(_["k"])(a),d=c.prefixCls,u=c.span,p=void 0===u?1:u,h=e.data.key,f=Object(_["g"])(a,"label"),m=Object(_["o"])(a),g={attrs:{},class:[d+"-item-label",(n={},v()(n,d+"-item-colon",s),v()(n,d+"-item-no-label",!f),n)],key:h+"-label"};return"vertical"===l&&(g.attrs.colSpan=2*p-1),o?"label"===r?t("th",g,[f]):t("td",{class:d+"-item-content",key:h+"-content",attrs:{colSpan:2*p-1}},[m["default"]]):t("td",{attrs:{colSpan:p},class:d+"-item"},"vertical"===l?"content"===r?[t("span",{class:d+"-item-content",key:h+"-content"},[m["default"]])]:[t("span",{class:[d+"-item-label",v()({},d+"-item-colon",s)],key:h+"-label"},[f])]:[t("span",g,[f]),t("span",{class:d+"-item-content",key:h+"-content"},[m["default"]])])}},T=O,D=n("8e75"),N=n("b913"),A=n("7922"),F={prefixCls:C["a"].string,label:C["a"].any,span:C["a"].number};function j(t){var e=t;return void 0===t?e=[]:Array.isArray(t)||(e=[t]),e}for(var E={name:"ADescriptionsItem",props:Object(_["s"])(F,{span:1})},z={prefixCls:C["a"].string,bordered:C["a"].bool,size:C["a"].oneOf(["default","middle","small"]).def("default"),title:C["a"].any,column:C["a"].oneOfType([C["a"].number,C["a"].object]),layout:C["a"].oneOf(["horizontal","vertical"]),colon:C["a"].bool},I=function(t,e){var n=[],i=null,a=void 0,o=j(t);return o.forEach((function(t,s){var r=Object(_["k"])(t),l=t;i||(a=e,i=[],n.push(i));var c=s===o.length-1,d=!0;c&&(d=!r.span||r.span===a,l=Object(A["a"])(l,{props:{span:a}}));var u=r.span,p=void 0===u?1:u;i.push(l),a-=p,a<=0&&(i=null,Object(k["a"])(0===a&&d,"Descriptions","Sum of column `span` in a line exceeds `column` of Descriptions."))})),n},L={xxl:3,xl:3,lg:3,md:3,sm:2,xs:1},H={name:"ADescriptions",Item:E,mixins:[D["a"]],inject:{configProvider:{default:function(){return S["a"]}}},props:Object(_["s"])(z,{column:L}),data:function(){return{screens:{},token:void 0}},methods:{getColumn:function(){var t=this.$props.column;if("object"===("undefined"===typeof t?"undefined":y()(t)))for(var e=0;e<x["b"].length;e++){var n=x["b"][e];if(this.screens[n]&&void 0!==t[n])return t[n]||L[n]}return"number"===typeof t?t:3},renderRow:function(t,e,n,i,a,o){var s=n.prefixCls,r=this.$createElement,l=function(t,e,n){return r(T,{attrs:{child:t,bordered:i,colon:o,type:e,layout:a},key:e+"-"+(t.key||n)})},c=[],d=[];return j(t).forEach((function(t,e){c.push(l(t,"label",e)),"vertical"===a?d.push(l(t,"content",e)):i&&c.push(l(t,"content",e))})),"vertical"===a?[r("tr",{class:s+"-row",key:"label-"+e},[c]),r("tr",{class:s+"-row",key:"content-"+e},[d])]:r("tr",{class:s+"-row",key:e},[c])}},mounted:function(){var t=this,e=this.$props.column;this.token=x["a"].subscribe((function(n){"object"===("undefined"===typeof e?"undefined":y()(e))&&t.setState({screens:n})}))},beforeDestroy:function(){x["a"].unsubscribe(this.token)},render:function(){var t,e=this,n=arguments[0],i=this.$props,a=i.prefixCls,o=i.size,s=i.bordered,r=void 0!==s&&s,l=i.layout,c=void 0===l?"horizontal":l,d=i.colon,u=void 0===d||d,p=Object(_["g"])(this,"title")||null,h=this.configProvider.getPrefixCls,f=h("descriptions",a),m=this.getColumn(),g=this.$slots["default"],b=j(g).map((function(t){return Object(_["v"])(t)?Object(A["a"])(t,{props:{prefixCls:f}}):null})).filter((function(t){return t})),w=I(b,m);return n("div",{class:[f,(t={},v()(t,f+"-"+o,"default"!==o),v()(t,f+"-bordered",!!r),t)]},[p&&n("div",{class:f+"-title"},[p]),n("div",{class:f+"-view"},[n("table",[n("tbody",[w.map((function(t,n){return e.renderRow(t,n,{prefixCls:f},r,c,u)}))])])])])},install:function(t){t.use(N["a"]),t.component(H.name,H),t.component(H.Item.name,H.Item)}},W=H,P=(n("50c5"),n("c0a4")),$=h["a"].caseType,B=h["a"].caseStatusObj,R=h["a"].caseColors,V=W.Item,J=[],K=0;K<12;K+=1)J.push({x:"".concat(K+1,"月"),y:Math.floor(1e3*Math.random())+200});var U=[],q=["上报","结案","处置"],X=["玄武","秦淮","建邺","鼓楼","浦口","栖霞","雨花台","江宁","六合","溧水","高淳"];for(var Y in q){var G={name:q[Y]};for(var Q in X)G[X[Q]]=Math.floor(100*Math.random());U.push(G)}var Z={components:{ChartCard:s["b"],Trend:s["p"],MiniPie:s["j"],MiniArea:s["h"],MiniBar:s["i"],StackingBar:s["n"],Bar:s["a"],MiniProgress:s["k"],Ellipsis:s["f"],ADescriptions:W,ADescriptionsItem:V,Edit:l["a"]},directives:{infiniteScroll:m.a},name:"TestAmap",data:function(){return{loading:!0,pagination:{pageNo:1,pageSize:4,totalPage:0,total:0},modalData:{},reportData:{},caseType:{},caseColors:R,activeKey:"",map:null,polyEditor:null,polygon:null,el:null,divHeight:918,data:[],barData:J,barData2:U,areaArr:X,statusObj:B,wsUrl:p["a"].wsUrl,isFullScreen:!1,listLoading:!1,busy:!1}},computed:Object(o["a"])({getHeight:function(){return this.divHeight+"px"}},Object(u["mapGetters"])(["userInfo"])),mounted:function(){var t=this;this.initCaseReportData(),window.onresize=function(){document.body.clientHeight!==window.screen.height?t.isFullScreen=!1:t.isFullScreen=!0}},created:function(){var t=this;this.initWebSocket(),this.loadData(),this.caseType=$,setTimeout((function(){t.loading=!t.loading}),1e3)},destroyed:function(){this.websock.close()},methods:{amapView:function(t){console.log("points",t),console.log("this.points",this.points);var e=this;this.el=document.getElementById("fullContainer"),this.map&&this.map.destroy(),this.map=new AMap.Map("container",{zoom:13,center:[118.76979,32.066336]});var n=this.map,i=(new AMap.Size(32,32),new AMap.Pixel(-16,-30),new AMap.Size(32,32),new AMap.Pixel(-16,-30),new AMap.Size(48,48),new AMap.Pixel(-24,-45),this.cluster);this.points&&n.remove(this.points),this.points=t;var a=60;this.count=t.length,n.plugin(["AMap.MarkerClusterer"],(function(){i=new AMap.MarkerClusterer(n,t,{gridSize:a,renderClusterMarker:e._renderClusterMarker,renderMarker:e._renderMarker}),e.cluster=i,n.setFitView()})),n.on("click",(function(){e.closeInfoWindow()})),setTimeout((function(){n.setFitView()}),3e3)},_renderClusterMarker:function(t){var e=this.count,n=Math.pow(t.count/e,1/18),i=document.createElement("div"),a=180-180*n,o="hsla("+a+",100%,40%,0.7)",s="hsla("+a+",100%,90%,1)",r="hsla("+a+",100%,40%,1)",l="hsla("+a+",100%,90%,1)";i.style.backgroundColor=o;var c=Math.round(30+20*Math.pow(t.count/e,.2));i.style.width=i.style.height=c+"px",i.style.border="solid 1px "+r,i.style.borderRadius=c/2+"px",i.style.boxShadow="0 0 5px "+l,i.innerHTML=t.count,i.style.lineHeight=c+"px",i.style.color=s,i.style.fontSize="14px",i.style.textAlign="center",t.marker.setOffset(new AMap.Pixel(-c/2,-c/2)),t.marker.setContent(i)},_renderMarker:function(t){var e=this,n='<div style="background-color: hsla(180, 100%, 50%, 0.3); height: 18px; width: 18px; border: 1px solid hsl(180, 100%, 40%); border-radius: 12px; box-shadow: hsl(180, 100%, 50%) 0px 0px 3px;"></div>',i=new AMap.Pixel(-9,-9);t.marker.setContent(n),t.marker.setOffset(i),t.marker.on("click",(function(n){var i=t.data[0];e.openInfoWindow([n.lnglat.getLng(),n.lnglat.getLat()],i)}))},openInfoWindow:function(t,e){console.log("record",e);var n=this,i='<div style="padding:7px 0px 0px 0px;"><h4>案件详情</h4>',a=[];e&&(i=i+"<p class='input-item'>案件编号 : "+(e.caseNo?e.caseNo:"")+"</p>",i=i+"<p class='input-item'>案件来源 : "+(e.casesource?e.casesource:""),i=i+"    上报人 :"+(e.reportor?e.reportor:"")+"</p>",i=i+"<p class='input-item'>案件类型 : "+(e.casetype?e.casetype:""),i=i+"    上报时间 : "+(e.reporTime?e.reporTime:"")+"</p>",i=i+"<p class='input-item'>案件样本 : "+(e.sampleName?e.sampleName:"")+"</p><p class='input-item'>案件描述 : "+(e.caseDesc?e.caseDesc:"")+"</p><p class='input-item'>案件位置描述 : "+(e.locationDesc?e.locationDesc:"")+"</p>",i+="</div>");var o=JSON.parse(JSON.stringify(a));for(var s in o)o[s].url="/api"+o[s].url;var r=P["a"].extend({template:i,methods:{showCarousel:function(t){console.log(o),n.$refs.bigPic.loadData(o,t)}}}),l=(new r).$mount();console.log("component",l);var c=new AMap.InfoWindow({anchor:"top-center"});c.setContent(l.$el),c.open(this.map,t),this.infoWindow=c},closeInfoWindow:function(){this.infoWindow&&this.infoWindow.close()},showCase:function(t){console.log("showCase",t);var e=[t.lng,t.lat];this.openInfoWindow(e,t)},fullScreen:function(){var t=this.el;this.divHeight=window.screen.height-48,this.isFullScreen=!0;var e,n=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;"undefined"!=typeof n&&n?n.call(t):"undefined"!=typeof window.ActiveXObject&&(e=new ActiveXObject("WScript.Shell"),e&&e.SendKeys("{F11}"))},exitFullScreen:function(){var t=this.el;this.divHeight=918,this.isFullScreen=!1;t=document;var e,n=t.cancelFullScreen||t.webkitCancelFullScreen||t.mozCancelFullScreen||t.exitFullScreen;"undefined"!=typeof n&&n?n.call(t):"undefined"!=typeof window.ActiveXObject&&(e=new ActiveXObject("WScript.Shell"),null!=e&&e.SendKeys("{F11}"))},initCaseReportData:function(){var t=this;Object(r["j"])().then((function(e){console.log("caseReportData().res.result",e.result),t.reportData=e.result})).catch((function(t){}))},changeTab:function(t){this.activeKey=t,this.selectTab=this.caseType[t]},info:function(t){for(var e in this.caseType)$[e].status==t.status&&this.changeTab(e);this.modalData={record:JSON.parse(JSON.stringify(t)),visible:!0,disabled:!0,title:this.activeKey,selectTab:this.selectTab}},loadData:function(){var t=this;console.log("this",this);var e={pageNo:1,pageSize:this.pagination.pageSize};Object(r["b"])(d.a.stringify(e)).then((function(e){t.data=e.result.data,t.pagination.pageNo=e.result.pageNo,t.pagination.totalPage=e.result.totalPage,t.pagination.total=e.result.totalCount,t.data.forEach((function(t){t.weight=1,t.lnglat=[t.lng,t.lat]})),t.amapView(t.data)})).catch((function(t){}))},loadMore:function(){var t=this,e=this;if(this.listLoading=!0,console.log("this",this),this.pagination.pageNo>=this.pagination.totalPage)g["a"].info({message:"Info",description:"没有更多数据加载"});else{var n={pageNo:this.pagination.pageNo+1,pageSize:this.pagination.pageSize};Object(r["b"])(d.a.stringify(n)).then((function(n){n.result.data.length>0?(e.data=e.data.concat(n.result.data),e.pagination.pageNo=n.result.pageNo,e.pagination.totalPage=n.result.totalPage,e.pagination.total=n.result.totalCount,e.data.forEach((function(t){t.weight=1,t.lnglat=[t.lng,t.lat]})),e.amapView(e.data)):g["a"].info({message:"Info",description:"没有更多数据加载"}),t.listLoading=!1})).catch((function(t){}))}},initWebSocket:function(){this.userId=this.userInfo.id,this.wsUri=this.wsUrl+"/screen/"+(new Date).getTime()+this.userId,this.websock=new WebSocket(this.wsUri),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){this.isWebSocket=!0,console.log("链接成功！",this.isWebSocket)},websocketonerror:function(){this.$message.info("重新建立链接中"),this.initWebSocket()},websocketonmessage:function(t){console.log("resdata",t.data);try{var e=JSON.parse(t.data);this.data=e.caseList.result.data,this.reportData=e.reportData.result,this.pagination.total=res.caseList.result.totalCount}catch(t){console.log("websocketonmessage",t)}},websocketclose:function(t){this.isWebSocket=!1,this.websock.close(),console.log("断开连接",t)},handleInfiniteOnLoad:function(){this.data;this.listLoading=!0,this.loadData(),this.busy=!0},handleModalEvent:function(t){this.loadData()}}},tt=Z,et=(n("ef31"),n("c701")),nt=Object(et["a"])(tt,i,a,!1,null,null,null);e["default"]=nt.exports},b81e9:function(t,e,n){},ef31:function(t,e,n){"use strict";n("b81e9")}}]);